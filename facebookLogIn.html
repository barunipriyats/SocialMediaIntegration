<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Integration</title>
    <meta name="description" content="Sign In / Sign Up along with Social Media Integration">
    <meta name="author" content="Baruni Priya T S">
    <link rel="shortcut icon" href="img/TitleLogo.svg">
    <link rel="stylesheet" href="css/facebookLogIn.css">
</head>
<body>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.2/angular.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>

    <script type="text/javascript" src="js/vanilla-tilt.js"></script>

    <section>
        <div class="container">
            <div class="row margin-bottom-small">
                <div id="login-button" class="fb-login-button" data-max-rows="1" data-size="large" data-show-faces="false" data-auto-logout-link="false" onlogin="checkLoginState();">Log in with Facebook</div>
                <div hidden id="logout-button" class="fb-login-button" data-max-rows="1" data-size="large" data-show-faces="false" data-auto-logout-link="false" onlogin="logout();">Log Out</div>
            </div>
        </div>
    </section>

    <div id="data" style="display: none">
        <div class="container">
            <div class="card">
                <div class="content">
                    <div class="imgBx">
                        <img id="image" class="rounded-circle" width="100px" height="100px"/>
                    </div>
                  </div>
                  <ul class="sci">
                    <li style="--i:1">
                      <p class="name">Name: <span id="name"></span></p>
                      <p class="first">First: <span id="first"></span></p>
                      <p class="last">Last: <span id="last"></span></p>
                      <input type="submit" value="Sign Out" class="btn solid" onclick="logout();">
                    </li>
                  </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        function statusChangeCallback(response) {
            console.log('statusChangeCallback');
            console.log(response);
            if (response.status === 'connected') {
                testAPI();
            } else {
                // The person is not logged into your app or we are unable to tell.
                //document.getElementById('status').innerHTML = 'Please log into this app.';
                document.getElementById('login-button').style.display = 'block';
                document.getElementById('logout-button').style.display = 'none';
            }
        }
        
        function checkLoginState() {
            FB.getLoginStatus(function(response) {
                statusChangeCallback(response);
            });
        }
        
        function logout() {
            FB.logout(function (response) {
                document.getElementById('logout-button').style.display = 'none';
                document.getElementById('login-button').style.display = '';
                document.location.reload();
            });
        }
        
        window.fbAsyncInit = function() {
                                FB.init({
                                appId      : '3744043092364414',
                                cookie     : true,  // enable cookies to allow the server to access the session
                                xfbml      : true,  // parse social plugins on this page
                                version    : 'v11.0' // use graph api version 2.8
                            });
            FB.getLoginStatus(function(response) {
                statusChangeCallback(response);
            });
        };
        
        (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        function testAPI() {
            console.log('Welcome!  Fetching your information.... ');
            FB.api('/me', 'GET', {
                fields: 'first_name,last_name,name,picture.width(100).height(100)'
            }, function(response) {
                console.log('Successful login for: ' + response.name);
                 document.getElementById('login-button').style.display = 'none';
                document.getElementById('logout-button').style.display = 'none';
                document.getElementById('data').style.display = 'block';
                $("#image").attr('src', response.picture.data.url);
                $("#name").text(response.name);
                $("#first").text(response.first_name);
                $("#last").text(response.last_name);
            });
        }
    </script>
    
</body>
</html>
